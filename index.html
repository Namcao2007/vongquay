<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Vòng xoay may mắn</title>
  <style>
    :root{--size:420px}
    body{font-family:system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial;margin:0;min-height:100vh;display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg,#f6f8ff,#ffffff);}
    .container{display:flex;flex-direction:column;align-items:center;gap:18px}
    .wheel-wrap{width:var(--size);height:var(--size);position:relative}
    canvas{width:100%;height:100%;border-radius:50%;display:block;transform:rotate(0deg);transition:transform 5s cubic-bezier(.2,.9,.2,1)}
    .pointer{position:absolute;left:50%;top:-10px;transform:translateX(-50%);width:0;height:0;border-left:18px solid transparent;border-right:18px solid transparent;border-bottom:30px solid #ff3b30;filter:drop-shadow(0 3px 4px rgba(0,0,0,0.2))}
    button{padding:10px 18px;border-radius:10px;border:0;background:#2563eb;color:#fff;font-weight:600;cursor:pointer;box-shadow:0 6px 18px rgba(37,99,235,0.18)}
    .result{min-height:28px;font-weight:700}
    .meta{font-size:12px;color:#666}
  </style>
</head>
<body>
  <div class="container">
    <h2>Vòng xoay may mắn</h2>
    <div class="wheel-wrap">
      <div class="pointer" title="Vị trí trúng"></div>
      <canvas id="wheel" width="800" height="800"></canvas>
    </div>

    <div style="display:flex;gap:12px;align-items:center;">
      <button id="spinBtn">Xoay!</button>
      <div class="result" id="result">Nhấn "Xoay!" để bắt đầu</div>
    </div>
    <div class="meta">Mỗi lần xoay là NGẪU NHIÊN — kết quả hiển thị vùng (theo danh sách bạn cung cấp).</div>
  </div>

<script>
(function(){
  const labels = [
    '1-8',
    '8-16',
    '16-24',
    '24-32',
    '32-40',
    '40-48',
    '48-56',
    '56-62',
    '64-72',
    '72-80'
  ];

  const canvas = document.getElementById('wheel');
  const ctx = canvas.getContext('2d');
  const size = Math.min(canvas.width, canvas.height);
  const center = {x: canvas.width/2, y: canvas.height/2};
  const outerR = size*0.45;
  const innerR = size*0.12;
  const sliceCount = labels.length;
  const sliceAngle = 360 / sliceCount; // degrees
  const startOffset = -90; // start drawing from top

  // draw wheel
  function drawWheel(){
    ctx.clearRect(0,0,canvas.width,canvas.height);

    for(let i=0;i<sliceCount;i++){
      const startDeg = startOffset + i*sliceAngle;
      const endDeg = startDeg + sliceAngle;
      const start = degToRad(startDeg);
      const end = degToRad(endDeg);

      // alternating colors
      ctx.beginPath();
      ctx.moveTo(center.x, center.y);
      ctx.arc(center.x, center.y, outerR, start, end);
      ctx.closePath();
      ctx.fillStyle = i%2===0 ? '#ffedd5' : '#fff7ed';
      ctx.fill();
      ctx.strokeStyle = '#f3f4f6';
      ctx.lineWidth = 2;
      ctx.stroke();

      // draw label
      const midDeg = startDeg + sliceAngle/2;
      const mid = degToRad(midDeg);
      const textRadius = outerR - 60;
      const tx = center.x + Math.cos(mid) * textRadius;
      const ty = center.y + Math.sin(mid) * textRadius;

      ctx.save();
      ctx.translate(tx, ty);
      ctx.rotate(mid + Math.PI/2);
      ctx.fillStyle = '#111827';
      ctx.font = 'bold 22px Arial';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      ctx.fillText(labels[i], 0, 0);
      ctx.restore();
    }

    // center circle
    ctx.beginPath();
    ctx.arc(center.x, center.y, innerR, 0, Math.PI*2);
    ctx.fillStyle = '#111827';
    ctx.fill();

    // small center text
    ctx.fillStyle = '#fff';
    ctx.font = 'bold 18px Arial';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillText('MAY MẮN', center.x, center.y);
  }

  function degToRad(d){return d*Math.PI/180}

  drawWheel();

  // Spin logic
  const wheelEl = canvas;
  const btn = document.getElementById('spinBtn');
  const resEl = document.getElementById('result');
  let isSpinning = false;

  btn.addEventListener('click', ()=>{
    if(isSpinning) return;
    isSpinning = true;
    resEl.textContent = 'Đang xoay...';

    // pick random index
    const pickedIndex = Math.floor(Math.random()*sliceCount);

    // random full rotations (so it feels realistic)
    const rotations = Math.floor(Math.random()*4) + 5; // 5..8 vòng

    // compute rotation degrees so that the chosen slice's center ends at top (-90deg)
    // rotation = rotations*360 - (index*sliceAngle + sliceAngle/2)
    const rotation = rotations*360 - (pickedIndex*sliceAngle + sliceAngle/2);

    // apply transform
    wheelEl.style.transition = 'transform 5s cubic-bezier(.2,.9,.2,1)';
    wheelEl.style.transform = `rotate(${rotation}deg)`;

    // when transition ends, announce result
    const onEnd = ()=>{
      wheelEl.removeEventListener('transitionend', onEnd);
      isSpinning = false;
      // normalize rotation to 0..360 so we can compute landed index (optional)
      const landedIndex = pickedIndex; // we already know
      resEl.textContent = `Kết quả: ${labels[landedIndex]}`;
      // subtle re-draw to ensure crisp text (canvas not changed, but keeping it)
    };

    wheelEl.addEventListener('transitionend', onEnd);
  });

  // allow resizing the canvas for high-DPI screens
  function fixHiDPI(){
    const ratio = window.devicePixelRatio || 1;
    const w = canvas.clientWidth * ratio;
    const h = canvas.clientHeight * ratio;
    if (canvas.width !== w || canvas.height !== h){
      canvas.width = w;
      canvas.height = h;
      // recalc center, radii
      // (we use clientWidth for drawing coordinates in drawWheel so adapt)
    }
    // set drawing params to match CSS size
    // update center and radii based on canvas.width/height
    const minSide = Math.min(canvas.width, canvas.height);
    center.x = canvas.width/2;
    center.y = canvas.height/2;
  }

  // optional: re-draw on window resize
  window.addEventListener('resize', ()=>{
    // keep drawing crisp
    // for simplicity, re-run drawWheel (canvas size static here)
    drawWheel();
  });

})();
</script>
</body>
</html>
